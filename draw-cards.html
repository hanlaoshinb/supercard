<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½å–å¡”ç½—ç‰Œ - å¡”ç½—ç‰Œåœ¨çº¿å åœ</title>
    <meta name="description" content="æŠ½å–æ‚¨çš„å¡”ç½—ç‰Œï¼Œè·å¾—ä¸“ä¸šå¡”ç½—ç‰Œå åœè§£è¯»ï¼Œäº†è§£æ‚¨çš„çˆ±æƒ…ã€äº‹ä¸šå’Œäººç”Ÿèµ°å‘ã€‚">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7D56F4', // ä¸»è‰²è°ƒï¼Œç´«è‰²
                        secondary: '#FFC107', // è¾…åŠ©è‰²ï¼Œé‡‘è‰²
                        dark: '#1D1D1F', // æ·±è‰²èƒŒæ™¯
                        light: '#F5F5F7', // æµ…è‰²èƒŒæ™¯
                    },
                    fontFamily: {
                        sans: ['SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .tarot-card {
                transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                transform-style: preserve-3d;
                perspective: 1000px;
            }
            
            .tarot-card.flipped {
                transform: rotateY(180deg);
            }
            
            .tarot-card-front,
            .tarot-card-back {
                backface-visibility: hidden;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }
            
            .tarot-card-front {
                transform: rotateY(180deg);
            }
            
            .tarot-card-back {
                transform: rotateY(0deg);
            }
            
            .card-1 {
                transform: translateX(-40%) rotate(-8deg);
            }
            
            .card-2 {
                transform: translateX(0);
                z-index: 10;
            }
            
            .card-3 {
                transform: translateX(40%) rotate(8deg);
            }
            
            @keyframes float {
                0% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-10px);
                }
                100% {
                    transform: translateY(0px);
                }
            }
            
            .floating {
                animation: float 3s ease-in-out infinite;
            }

            .card-wrapper {
                position: relative;
                overflow: hidden;
            }
            
            .mystic-bg {
                background: linear-gradient(135deg, #1a1a2e, #16213e, #1a1a2e);
            }
            
            .card-slot {
                border: 2px dashed rgba(215, 170, 100, 0.3);
                border-radius: 0.75rem;
                display: flex;
                align-items: center;
                justify-content: center;
                color: rgba(215, 170, 100, 0.5);
                background: rgba(0, 0, 0, 0.2);
                transition: all 0.3s ease;
                position: relative;
            }
            
            .card-slot.highlight {
                border-color: rgba(215, 170, 100, 0.8);
                box-shadow: 0 0 15px rgba(215, 170, 100, 0.4);
            }
            
            .card-slot.filled {
                border-style: solid;
                border-color: rgba(215, 170, 100, 0.5);
                background: rgba(0, 0, 0, 0.3);
            }
            
            .card-slot.filled span {
                opacity: 0;
            }

            .canvas-container {
                position: relative;
                width: 100%;
                height: 300px;
                overflow: hidden;
            }
            
            #tarotCanvas {
                cursor: pointer;
                display: block;
                margin: 0 auto;
                background: transparent;
            }
            
            .card-info-panel {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 300px;
                background: rgba(26, 26, 46, 0.95);
                border: 1px solid rgba(215, 170, 100, 0.5);
                border-radius: 15px;
                padding: 20px;
                z-index: 100;
                box-shadow: 0 0 30px rgba(0, 0, 0, 0.6), 0 0 15px rgba(215, 170, 100, 0.4);
                display: none;
                backdrop-filter: blur(10px);
            }
            
            .card-info-panel img {
                width: 120px;
                margin: 0 auto 15px;
                display: block;
                border-radius: 5px;
                border: 1px solid rgba(215, 170, 100, 0.5);
            }
            
            .card-info-panel h3 {
                color: rgb(215, 170, 100);
                font-size: 1.25rem;
                text-align: center;
                margin-bottom: 10px;
                font-weight: 600;
            }
            
            .card-info-panel p {
                color: rgba(255, 255, 255, 0.8);
                font-size: 0.9rem;
                line-height: 1.5;
                margin-bottom: 15px;
            }
            
            .card-info-panel button {
                background: linear-gradient(45deg, #7D56F4, #9678FF);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.9rem;
                cursor: pointer;
                width: 100%;
                transition: all 0.3s ease;
            }
            
            .card-info-panel button:hover {
                background: linear-gradient(45deg, #6A46E5, #8A6BFF);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            }
            
            .overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(3px);
                z-index: 90;
                display: none;
            }
        }
    </style>
</head>
<body class="font-sans text-dark bg-light min-h-screen flex flex-col">
    <!-- ç§»åŠ¨è®¾å¤‡å¯¼èˆªèœå• -->
    <div id="mobile-menu" class="fixed inset-0 bg-dark/95 z-50 flex items-center justify-center transform transition-transform duration-300 translate-x-full">
        <button id="close-menu" class="absolute top-5 right-5 text-white focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <nav class="flex flex-col items-center space-y-6">
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                <span class="mr-1">ğŸ‘‘</span> ä¼šå‘˜è®¢é˜…
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                AIå¡”ç½—å åœ
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                æ•…äº‹åˆ†äº«
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                é—®é¢˜åé¦ˆ
            </a>
        </nav>
    </div>

    <!-- å¯¼èˆªæ  -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="/" class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
                <span class="text-xl font-bold">Tarotap</span>
            </a>
            
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    <span class="mr-1">ğŸ‘‘</span> ä¼šå‘˜è®¢é˜…
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    AIå¡”ç½—å åœ
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    æ•…äº‹åˆ†äº«
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    é—®é¢˜åé¦ˆ
                </a>
            </nav>
            
            <div class="flex items-center space-x-4">
                <button id="mobile-menu-btn" class="md:hidden text-dark focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div class="hidden md:block h-8 w-8 rounded-full bg-gradient-to-r from-primary to-purple-300 flex items-center justify-center text-white">
                    <span class="text-sm font-medium">M</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="flex-grow">
        <!-- æŠ½ç‰ŒåŒºåŸŸ -->
        <section class="py-6 md:py-8 text-center">
            <div class="container mx-auto px-4 max-w-4xl">
                <h1 class="text-3xl md:text-4xl font-bold mb-3 flex flex-col items-center justify-center">
                    <span class="text-gradient bg-gradient-to-r from-purple-500 to-primary block">æ—¶é—´æµç‰Œé˜µ</span>
                </h1>
                
                <p class="text-gray-600 text-sm md:text-base max-w-2xl mx-auto mb-6">åœ¨ç‰Œåˆ—ä¸­é€‰æ‹©å¹¶ç‚¹å‡»ä¸‰å¼ å¡”ç½—ç‰Œï¼Œæ­ç¤ºè¿‡å»ã€ç°åœ¨å’Œæœªæ¥çš„è®¯æ¯ã€‚</p>
                
                <!-- ç”¨æˆ·é—®é¢˜æ˜¾ç¤º -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-8">
                    <h3 class="text-gray-500 text-sm mb-1">æ‚¨çš„é—®é¢˜</h3>
                    <p id="user-question" class="text-gray-800 font-medium">åŠ è½½ä¸­...</p>
                </div>
                
                <!-- å·²é€‰æ‹©å¡ç‰Œæ•°é‡æŒ‡ç¤ºå™¨ -->
                <div class="mb-4 text-center">
                    <span class="text-white bg-primary/90 px-4 py-1.5 rounded-full font-medium" id="cards-counter">å·²é€‰æ‹©: 0/3</span>
                </div>
                
                <!-- Canvas æŠ½ç‰ŒåŒºåŸŸ -->
                <div class="card-wrapper mystic-bg rounded-xl overflow-hidden shadow-lg">
                    <div class="canvas-container">
                        <canvas id="tarotCanvas"></canvas>
                    </div>
                    
                    <!-- å¡ç‰Œæ§½ä½ -->
                    <div class="flex flex-col md:flex-row justify-center gap-4 md:gap-8 p-6">
                        <div class="card-slot relative h-44 w-28 md:h-52 md:w-32 flex items-center justify-center" data-position="è¿‡å»">
                            <span class="opacity-50">è¿‡å»</span>
                        </div>
                        <div class="card-slot relative h-44 w-28 md:h-52 md:w-32 flex items-center justify-center" data-position="ç°åœ¨">
                            <span class="opacity-50">ç°åœ¨</span>
                        </div>
                        <div class="card-slot relative h-44 w-28 md:h-52 md:w-32 flex items-center justify-center" data-position="æœªæ¥">
                            <span class="opacity-50">æœªæ¥</span>
                        </div>
                    </div>
                </div>
                
                <!-- æŒ‡å¼•æ–‡å­— -->
                <p id="draw-instruction" class="text-primary font-medium my-6">è¯·åœ¨ç‰Œåˆ—ä¸­é€‰æ‹©ä¸‰å¼ å¡”ç½—ç‰Œ</p>
                
                <!-- æŸ¥çœ‹ç»“æœæŒ‰é’® (åˆå§‹éšè—) -->
                <div id="view-result-btn" class="hidden">
                    <a href="#" class="inline-block bg-gradient-to-r from-primary to-purple-800 text-white font-medium py-3 px-8 rounded-lg shadow-lg hover:shadow-xl hover:translate-y-[-2px] transition-all duration-200 relative overflow-hidden group">
                        <span class="relative z-10">æŸ¥çœ‹å åœç»“æœ</span>
                        <span class="absolute inset-0 bg-gradient-to-r from-primary/80 to-purple-700/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                    </a>
                </div>
            </div>
        </section>
    </main>
    
    <!-- å¡ç‰Œä¿¡æ¯é¢æ¿ -->
    <div class="card-info-panel" id="cardInfoPanel">
        <img src="" alt="å¡”ç½—ç‰Œ" id="cardImage">
        <h3 id="cardName">å¡”ç½—ç‰Œåç§°</h3>
        <p id="cardDescription">å¡”ç½—ç‰Œæè¿°å†…å®¹...</p>
        <button id="placeCardBtn">æ”¾ç½®å¡ç‰Œ</button>
    </div>
    
    <!-- èƒŒæ™¯é®ç½© -->
    <div class="overlay" id="overlay"></div>

    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">å…³äºæˆ‘ä»¬</h3>
                    <p class="text-gray-400 text-sm">Tarotapæ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ¨çº¿å¡”ç½—ç‰Œå åœå¹³å°ï¼Œè‡´åŠ›äºé€šè¿‡ç°ä»£ç§‘æŠ€ä¸å¤è€æ™ºæ…§çš„ç»“åˆï¼Œä¸ºç”¨æˆ·æä¾›å‡†ç¡®ã€ä¾¿æ·çš„å¡”ç½—ç‰Œè§£è¯»æœåŠ¡ã€‚</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">å¿«é€Ÿé“¾æ¥</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">é¦–é¡µ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">å¡”ç½—ç‰Œå åœ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">ä¼šå‘˜æœåŠ¡</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">å­¦ä¹ ä¸­å¿ƒ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">è”ç³»æˆ‘ä»¬</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <span class="text-gray-400">contact@aihinto.com</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">å…³æ³¨æˆ‘ä»¬</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
                <p>&copy; 2025 Tarotap. ç‰ˆæƒæ‰€æœ‰ Michael</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript ä»£ç  -->
    <script>
        // ç§»åŠ¨è®¾å¤‡èœå•æ§åˆ¶
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenuBtn = document.getElementById('close-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-full');
            mobileMenu.classList.add('translate-x-0');
        });

        closeMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-0');
            mobileMenu.classList.add('translate-x-full');
        });
        
        // ä»URLè·å–æŸ¥è¯¢å‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const master = urlParams.get('master');
        const question = urlParams.get('question');
        const spread = urlParams.get('spread');
        
        // æ˜¾ç¤ºç”¨æˆ·é—®é¢˜
        const userQuestionEl = document.getElementById('user-question');
        if (question) {
            userQuestionEl.textContent = decodeURIComponent(question);
        } else {
            userQuestionEl.textContent = "æ²¡æœ‰æä¾›é—®é¢˜";
        }
        
        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºé€‰æ‹©çš„ç‰Œé˜µ
        const titleEl = document.querySelector('h1 span');
        if (spread) {
            const spreadName = decodeURIComponent(spread).replace(/-/g, ' ');
            const capitalizedSpread = spreadName.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
            titleEl.textContent = capitalizedSpread + 'ç‰Œé˜µ';
        }
        
        // Canvas ç›¸å…³å˜é‡
        const canvas = document.getElementById('tarotCanvas');
        const ctx = canvas.getContext('2d');
        const cardsCounter = document.getElementById('cards-counter');
        const drawInstruction = document.getElementById('draw-instruction');
        const viewResultBtn = document.getElementById('view-result-btn');
        const cardSlots = document.querySelectorAll('.card-slot');
        const cardInfoPanel = document.getElementById('cardInfoPanel');
        const overlay = document.getElementById('overlay');
        const cardImage = document.getElementById('cardImage');
        const cardName = document.getElementById('cardName');
        const cardDescription = document.getElementById('cardDescription');
        const placeCardBtn = document.getElementById('placeCardBtn');
        
        // å¡”ç½—ç‰Œæ•°æ®
        const tarotCardNames = [
            {name: "æ„šè€…", description: "ä»£è¡¨æ–°çš„å¼€å§‹å’Œæ— é™å¯èƒ½ï¼Œè±¡å¾ç€è‡ªç”±ã€å†’é™©å’Œæ½œåŠ›ã€‚æ„å‘³ç€éœ€è¦å¼€æ”¾å¿ƒæ€é¢å¯¹æœªçŸ¥äº‹ç‰©ã€‚"},
            {name: "é­”æœ¯å¸ˆ", description: "è±¡å¾åˆ›é€ åŠ›å’Œä¸»åŠ¨æ€§ï¼Œä»£è¡¨å°†æƒ³æ³•è½¬åŒ–ä¸ºè¡ŒåŠ¨çš„èƒ½åŠ›ã€‚æç¤ºä½ æœ‰èƒ½åŠ›æŒæ§å±€é¢ï¼Œå®ç°ç›®æ ‡ã€‚"},
            {name: "å¥³ç¥­å¸", description: "è±¡å¾ç›´è§‰å’Œæ½œæ„è¯†ï¼Œæç¤ºä½ å€¾å¬å†…å¿ƒçš„å£°éŸ³ï¼Œç›¸ä¿¡è‡ªå·±çš„æ„Ÿè§‰ã€‚å»ºè®®ä¿æŒè€å¿ƒï¼Œç­‰å¾…æ›´å¤šä¿¡æ¯æ˜¾ç°ã€‚"},
            {name: "å¥³çš‡", description: "ä»£è¡¨ä¸°ç››ã€æ»‹å…»å’Œåˆ›é€ ï¼Œè±¡å¾ç€çˆ±ã€å’Œè°ä¸å®‰å…¨æ„Ÿã€‚æç¤ºä½ å…³æ³¨ç‰©è´¨ä¸ç²¾ç¥çš„å¹³è¡¡ã€‚"},
            {name: "çš‡å¸", description: "è±¡å¾æƒå¨å’Œæ§åˆ¶ï¼Œä»£è¡¨ç»“æ„ã€ç¨³å®šå’Œç§©åºã€‚æç¤ºä½ éœ€è¦æ›´æœ‰æ¡ç†åœ°å¤„ç†äº‹åŠ¡ï¼Œå»ºç«‹æ˜ç¡®çš„ç•Œé™ã€‚"},
            {name: "æ•™çš‡", description: "ä»£è¡¨ä¼ ç»Ÿå’Œç²¾ç¥æŒ‡å¼•ï¼Œè±¡å¾éµå¾ªæ—¢å®šè§„åˆ™ä¸é“å¾·æ ‡å‡†ã€‚æç¤ºä½ å¯»æ±‚æ™ºæ…§æŒ‡å¯¼æˆ–å°Šé‡ä¼ ç»Ÿä»·å€¼è§‚ã€‚"},
            {name: "æ‹äºº", description: "è±¡å¾å…³ç³»å’Œé€‰æ‹©ï¼Œä»£è¡¨çˆ±æƒ…ã€å’Œè°ä¸ä»·å€¼è§‚çš„ç»Ÿä¸€ã€‚æç¤ºä½ é¢ä¸´é‡è¦é€‰æ‹©ï¼Œéœ€è¦å…¨é¢è€ƒè™‘ã€‚"},
            {name: "æˆ˜è½¦", description: "è±¡å¾å†³å¿ƒå’Œèƒœåˆ©ï¼Œä»£è¡¨é€šè¿‡è‡ªæ§å’Œä¸“æ³¨å®ç°ç›®æ ‡ã€‚æç¤ºä½ åšæŒä¸æ‡ˆï¼Œå…‹æœæŒ‘æˆ˜ï¼Œä¿æŒå‰è¿›ã€‚"},
            {name: "åŠ›é‡", description: "ä»£è¡¨å†…åœ¨åŠ›é‡å’Œå‹‡æ°”ï¼Œè±¡å¾é€šè¿‡è€å¿ƒå’Œè‡ªä¿¡å…‹æœå›°éš¾ã€‚æç¤ºä½ ç”¨æ¸©å’Œè€Œåšå®šçš„æ–¹å¼è§£å†³é—®é¢˜ã€‚"},
            {name: "éšè€…", description: "è±¡å¾å†…çœå’Œå¯»æ‰¾å†…åœ¨æ™ºæ…§ï¼Œä»£è¡¨ç‹¬å¤„å’Œåæ€çš„ä»·å€¼ã€‚æç¤ºä½ éœ€è¦æ—¶é—´æ²‰æ€ï¼Œå¯»æ‰¾å†…å¿ƒçš„ç­”æ¡ˆã€‚"},
            {name: "å‘½è¿ä¹‹è½®", description: "ä»£è¡¨å‘½è¿å˜åŒ–å’Œç”Ÿå‘½å‘¨æœŸï¼Œè±¡å¾ç€è½¬å˜å’Œæœºä¼šã€‚æç¤ºä½ æ¥å—å˜åŒ–ï¼Œç†è§£ç”Ÿæ´»çš„å¾ªç¯æœ¬è´¨ã€‚"},
            {name: "æ­£ä¹‰", description: "è±¡å¾å¹³è¡¡å’Œè¯šå®ï¼Œä»£è¡¨å…¬å¹³ã€çœŸç†å’Œæ³•å¾‹ã€‚æç¤ºä½ è¦å®¢è§‚å®¡è§†æƒ…å†µï¼Œå¯»æ±‚å¹³è¡¡çš„è§£å†³æ–¹æ¡ˆã€‚"},
            {name: "æ‚¬åŠè€…", description: "ä»£è¡¨ç‰ºç‰²å’Œæ–°è§†è§’ï¼Œè±¡å¾æ”¾æ‰‹å’Œæ¥å—ã€‚æç¤ºä½ éœ€è¦æ”¹å˜è§†è§’æˆ–æš‚åœè¡ŒåŠ¨ï¼Œè·å¾—æ–°çš„ç†è§£ã€‚"},
            {name: "æ­»ç¥", description: "è±¡å¾è½¬å˜å’Œç»“æŸï¼Œä»£è¡¨ä¸€ä¸ªé˜¶æ®µçš„å®Œç»“å’Œæ–°é˜¶æ®µçš„å¼€å§‹ã€‚æç¤ºä½ éœ€è¦æ”¾ä¸‹è¿‡å»ï¼Œè¿æ¥è½¬å˜ã€‚"},
            {name: "èŠ‚åˆ¶", description: "ä»£è¡¨å¹³è¡¡å’Œé€‚åº¦ï¼Œè±¡å¾å’Œè°èåˆä¸è‡ªæˆ‘æ§åˆ¶ã€‚æç¤ºä½ éœ€è¦è€å¿ƒã€é€‚åº¦å’Œå¹³è¡¡çš„æ–¹æ³•ã€‚"},
            {name: "æ¶é­”", description: "è±¡å¾æŸç¼šå’Œç‰©è´¨æ‰§ç€ï¼Œä»£è¡¨æ¬²æœ›å’Œä¾é™„ã€‚æç¤ºä½ éœ€è¦è®¤è¯†åˆ°è‡ªå·±çš„é™åˆ¶å’Œä¸å¥åº·çš„æ¨¡å¼ã€‚"},
            {name: "å¡”", description: "ä»£è¡¨çªç„¶å˜åŒ–å’Œå¯ç¤ºï¼Œè±¡å¾é¢ è¦†å’Œè§£æ”¾ã€‚æç¤ºä½ å¯èƒ½é¢ä¸´æ„å¤–çš„è½¬å˜ï¼Œéœ€è¦æ¥å—æ–°çš„ç°å®ã€‚"},
            {name: "æ˜Ÿæ˜Ÿ", description: "è±¡å¾å¸Œæœ›å’Œçµæ„Ÿï¼Œä»£è¡¨å†…å¿ƒå¹³é™å’Œç²¾ç¥æ›´æ–°ã€‚æç¤ºä½ è¦ä¿æŒä¿¡å¿ƒï¼Œç›¸ä¿¡æœªæ¥ä¼šæ›´ç¾å¥½ã€‚"},
            {name: "æœˆäº®", description: "ä»£è¡¨ç›´è§‰å’Œæ½œæ„è¯†ï¼Œè±¡å¾ææƒ§å’Œè¿·æƒ‘ã€‚æç¤ºä½ éœ€è¦é¢å¯¹å†…å¿ƒæ·±å¤„çš„æƒ…æ„Ÿå’Œä¸å®‰ã€‚"},
            {name: "å¤ªé˜³", description: "è±¡å¾æˆåŠŸå’Œæ´»åŠ›ï¼Œä»£è¡¨å–œæ‚¦å’Œæ¸…æ™°ã€‚æç¤ºä½ å³å°†è¿›å…¥ä¸€ä¸ªå……æ»¡æ­£èƒ½é‡å’ŒæˆåŠŸçš„æ—¶æœŸã€‚"},
            {name: "å®¡åˆ¤", description: "ä»£è¡¨è§‰é†’å’Œæ›´æ–°ï¼Œè±¡å¾é‡ç”Ÿå’Œè½¬å˜ã€‚æç¤ºä½ éœ€è¦è¯šå®é¢å¯¹è‡ªå·±ï¼Œæ¥å—çœŸæ­£çš„è‡ªæˆ‘ã€‚"},
            {name: "ä¸–ç•Œ", description: "è±¡å¾å®Œæˆå’Œæ•´åˆï¼Œä»£è¡¨æˆå°±å’Œåœ†æ»¡ã€‚æç¤ºä½ å·²ç»è¾¾åˆ°äº†ä¸€ä¸ªé‡è¦çš„é‡Œç¨‹ç¢‘ï¼Œå®Œæˆäº†ä¸€ä¸ªå‘¨æœŸã€‚"}
        ];
        
        // å¡”ç½—ç‰Œå¡ç‰Œç±»
        class TarotCard {
            constructor(id, name, description) {
                this.id = id;
                this.name = name;
                this.description = description;
                this.x = 0;
                this.y = 0;
                this.width = 70;
                this.height = 112;
                this.selected = false;
                this.highlighted = false;
                this.placed = false;
                this.position = null; // è¿‡å»ã€ç°åœ¨ã€æœªæ¥
                this.angle = 0; // æ—‹è½¬è§’åº¦
                this.currentScale = 1; // å½“å‰ç¼©æ”¾
                this.targetPosition = { x: 0, y: 0 }; // åŠ¨ç”»ç›®æ ‡ä½ç½®
                this.animating = false;
                this.slotElement = null; // å…³è”çš„æ§½ä½DOMå…ƒç´ 
            }
            
            draw(ctx) {
                ctx.save();
                
                // ç§»åŠ¨åˆ°å¡ç‰Œä¸­å¿ƒç‚¹
                ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
                
                // åº”ç”¨æ—‹è½¬
                ctx.rotate(this.angle * Math.PI / 180);
                
                // åº”ç”¨ç¼©æ”¾
                ctx.scale(this.currentScale, this.currentScale);
                
                // ç»˜åˆ¶å¡ç‰ŒèƒŒæ™¯
                ctx.shadowColor = this.highlighted ? 'rgba(215, 170, 100, 0.7)' : 'rgba(0, 0, 0, 0.3)';
                ctx.shadowBlur = this.highlighted ? 15 : 5;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 2;
                
                // å¡ç‰ŒèƒŒé¢
                const gradient = ctx.createLinearGradient(-this.width/2, -this.height/2, this.width/2, this.height/2);
                gradient.addColorStop(0, '#422e83');
                gradient.addColorStop(1, '#7D56F4');
                
                ctx.fillStyle = gradient;
                ctx.roundRect(-this.width/2, -this.height/2, this.width, this.height, 5);
                ctx.fill();
                
                // å¡ç‰Œè¾¹æ¡†
                ctx.lineWidth = 1;
                ctx.strokeStyle = this.highlighted ? 'rgba(215, 170, 100, 0.8)' : 'rgba(215, 170, 100, 0.3)';
                ctx.roundRect(-this.width/2, -this.height/2, this.width, this.height, 5);
                ctx.stroke();
                
                // å¡ç‰ŒèŠ±çº¹
                ctx.lineWidth = 0.5;
                ctx.strokeStyle = 'rgba(215, 170, 100, 0.2)';
                ctx.roundRect(-this.width/2 + 3, -this.height/2 + 3, this.width - 6, this.height - 6, 3);
                ctx.stroke();
                
                // å¡ç‰Œæ˜Ÿæ˜Ÿå›¾æ¡ˆ
                ctx.fillStyle = 'rgba(215, 170, 100, 0.3)';
                this.drawStar(ctx, 0, 0, 5, 10, 5);
                
                ctx.restore();
            }
            
            drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
                let rot = Math.PI / 2 * 3;
                let x = cx;
                let y = cy;
                let step = Math.PI / spikes;
                
                ctx.beginPath();
                ctx.moveTo(cx, cy - outerRadius);
                
                for (let i = 0; i < spikes; i++) {
                    x = cx + Math.cos(rot) * outerRadius;
                    y = cy + Math.sin(rot) * outerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                    
                    x = cx + Math.cos(rot) * innerRadius;
                    y = cy + Math.sin(rot) * innerRadius;
                    ctx.lineTo(x, y);
                    rot += step;
                }
                
                ctx.lineTo(cx, cy - outerRadius);
                ctx.closePath();
                ctx.fill();
            }
            
            isMouseOver(mouseX, mouseY) {
                return mouseX >= this.x && mouseX <= this.x + this.width &&
                       mouseY >= this.y && mouseY <= this.y + this.height;
            }
        }
        
        // ä¸»åº”ç”¨ç±»
        class TarotApp {
            constructor() {
                this.cards = [];
                this.selectedCards = [];
                this.currentCard = null;
                this.mouseX = 0;
                this.mouseY = 0;
                this.canvasWidth = 0;
                this.canvasHeight = 0;
                this.cardWidth = 70;
                this.cardHeight = 112;
                this.cardGap = 10;
                this.isDragging = false;
                this.isAnimating = false;
                this.currentSlot = null;
                
                this.init();
            }
            
            init() {
                // è°ƒæ•´Canvaså¤§å°
                this.resizeCanvas();
                
                // åˆ›å»ºå¡”ç½—ç‰Œ
                this.createCards();
                
                // è®¾ç½®äº‹ä»¶ç›‘å¬
                this.setupEventListeners();
                
                // å¼€å§‹åŠ¨ç”»å¾ªç¯
                this.animate();
            }
            
            resizeCanvas() {
                const container = canvas.parentElement;
                this.canvasWidth = container.clientWidth;
                this.canvasHeight = container.clientHeight;
                
                canvas.width = this.canvasWidth;
                canvas.height = this.canvasHeight;
                
                // è°ƒæ•´å¡ç‰Œå°ºå¯¸
                this.cardWidth = 70;  // å¢å¤§å¡ç‰Œå°ºå¯¸
                this.cardHeight = 112;
                
                // é‡æ–°æ’åˆ—å¡ç‰Œï¼Œå¦‚æœå·²å­˜åœ¨
                if (this.cards.length > 0) {
                    this.arrangeCards();
                }
            }
            
            createCards() {
                // æ¸…ç©ºç°æœ‰å¡ç‰Œ
                this.cards = [];
                
                // éšæœºé€‰æ‹©20å¼ å¡”ç½—ç‰Œ
                const shuffledCards = [...tarotCardNames].sort(() => Math.random() - 0.5).slice(0, 22);
                
                // åˆ›å»ºå¡ç‰Œå¯¹è±¡
                shuffledCards.forEach((card, index) => {
                    this.cards.push(new TarotCard(index, card.name, card.description));
                });
                
                // æ’åˆ—å¡ç‰Œ
                this.arrangeCards();
            }
            
            arrangeCards() {
                // æŠŠå¡ç‰Œæ”¾åœ¨ç”»å¸ƒä¸­æ›´é ä¸‹çš„ä½ç½®ï¼Œæ›´é è¿‘æ§½ä½
                const deckWidth = (this.cards.length - 1) * (this.cardWidth * 0.3) + this.cardWidth;
                let startX = (this.canvasWidth - deckWidth) / 2;
                
                this.cards.forEach((card, index) => {
                    card.width = this.cardWidth;
                    card.height = this.cardHeight;
                    card.x = startX + index * (this.cardWidth * 0.3);
                    card.y = 150; // è°ƒæ•´å‚ç›´ä½ç½®ï¼Œä½¿å…¶æ›´é è¿‘åº•éƒ¨çš„æ§½ä½
                    card.angle = 0;
                    card.currentScale = 1;
                });
            }
            
            setupEventListeners() {
                // é¼ æ ‡ç§»åŠ¨
                canvas.addEventListener('mousemove', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    this.mouseX = e.clientX - rect.left;
                    this.mouseY = e.clientY - rect.top;
                    
                    // æ£€æŸ¥å¡ç‰Œæ‚¬åœ
                    let hoveredCard = null;
                    
                    if (!this.isAnimating) {
                        // é€†åºæ£€æŸ¥ï¼Œè¿™æ ·æœ€ä¸Šé¢çš„å¡ç‰Œä¼šå…ˆæ£€æµ‹åˆ°
                        for (let i = this.cards.length - 1; i >= 0; i--) {
                            const card = this.cards[i];
                            if (!card.placed && card.isMouseOver(this.mouseX, this.mouseY)) {
                                hoveredCard = card;
                                break;
                            }
                        }
                    }
                    
                    // æ›´æ–°å¡ç‰Œé«˜äº®çŠ¶æ€
                    this.cards.forEach(card => {
                        card.highlighted = card === hoveredCard;
                        
                        // å¦‚æœå¡ç‰Œè¢«é«˜äº®ï¼Œç¨å¾®ç¼©æ”¾å®ƒ
                        if (card.highlighted && !card.animating) {
                            card.currentScale = 1.1;
                            card.y = 40; // ç¨å¾®å‘ä¸Šç§»åŠ¨
                        } else if (!card.animating && !card.placed) {
                            card.currentScale = 1;
                            card.y = 50;
                        }
                    });
                });
                
                // é¼ æ ‡ç‚¹å‡»
                canvas.addEventListener('click', (e) => {
                    if (this.isAnimating) return;
                    
                    // æ‰¾åˆ°ç‚¹å‡»çš„å¡ç‰Œ
                    let clickedCard = null;
                    
                    // é€†åºæ£€æŸ¥ï¼Œè¿™æ ·æœ€ä¸Šé¢çš„å¡ç‰Œä¼šå…ˆæ£€æµ‹åˆ°
                    for (let i = this.cards.length - 1; i >= 0; i--) {
                        const card = this.cards[i];
                        if (!card.placed && card.isMouseOver(this.mouseX, this.mouseY)) {
                            clickedCard = card;
                            break;
                        }
                    }
                    
                    if (clickedCard && this.selectedCards.length < 3) {
                        this.currentCard = clickedCard;
                        this.animateCardSelection(clickedCard);
                    }
                });
                
                // ç›‘å¬çª—å£å¤§å°å˜åŒ–
                window.addEventListener('resize', () => {
                    this.resizeCanvas();
                });
                
                // æ”¾ç½®å¡ç‰ŒæŒ‰é’®ç‚¹å‡»äº‹ä»¶
                placeCardBtn.addEventListener('click', () => {
                    // éšè—ä¿¡æ¯é¢æ¿
                    cardInfoPanel.style.display = 'none';
                    overlay.style.display = 'none';
                    
                    if (this.currentCard && this.currentSlot) {
                        this.placeCardInSlot(this.currentCard, this.currentSlot);
                    }
                });
            }
            
            // åŠ¨ç”»ï¼šé€‰ä¸­å¡ç‰Œ
            animateCardSelection(card) {
                this.isAnimating = true;
                card.animating = true;
                
                // è®¡ç®—å¡ç‰Œé£å‘å±å¹•ä¸­å¤®çš„åŠ¨ç”»
                const targetX = this.canvasWidth / 2 - card.width / 2;
                const targetY = this.canvasHeight / 2 - card.height / 2;
                
                // å­˜å‚¨ç›®æ ‡ä½ç½®
                card.targetPosition = { x: targetX, y: targetY };
                
                // è®¾ç½®åŠ¨ç”»æ—¶é—´
                const animationDuration = 500; // æ¯«ç§’
                const startTime = Date.now();
                const startX = card.x;
                const startY = card.y;
                const startScale = card.currentScale;
                const targetScale = 2.5; // æ”¾å¤§2.5å€
                
                // è®¾ç½®å¡ç‰Œæ—‹è½¬éšæœºè§’åº¦ (-5åˆ°5åº¦)
                const targetAngle = Math.random() * 10 - 5;
                const startAngle = card.angle;
                
                // åŠ¨ç”»å‡½æ•°
                const animate = () => {
                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / animationDuration, 1);
                    
                    // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°ä½¿åŠ¨ç”»æ›´è‡ªç„¶
                    const easeProgress = this.easeOutQuad(progress);
                    
                    // æ›´æ–°å¡ç‰Œä½ç½®
                    card.x = startX + (targetX - startX) * easeProgress;
                    card.y = startY + (targetY - startY) * easeProgress;
                    card.currentScale = startScale + (targetScale - startScale) * easeProgress;
                    card.angle = startAngle + (targetAngle - startAngle) * easeProgress;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // åŠ¨ç”»å®Œæˆï¼Œæ˜¾ç¤ºå¡ç‰Œä¿¡æ¯
                        this.showCardInfo(card);
                        card.animating = false;
                        this.isAnimating = false;
                    }
                };
                
                requestAnimationFrame(animate);
            }
            
            // æ˜¾ç¤ºå¡ç‰Œä¿¡æ¯é¢æ¿
            showCardInfo(card) {
                // è®¾ç½®å¡ç‰Œä¿¡æ¯
                cardImage.src = 'quin1.jpg'; // ç”¨ä¸€ä¸ªé»˜è®¤å›¾ç‰‡
                cardName.textContent = card.name;
                cardDescription.textContent = card.description;
                
                // æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„å¡ç‰Œæ§½
                let availableSlot = null;
                for (const slot of cardSlots) {
                    if (!slot.hasAttribute('data-filled')) {
                        availableSlot = slot;
                        break;
                    }
                }
                
                if (availableSlot) {
                    this.currentSlot = availableSlot;
                    
                    // é«˜äº®æ˜¾ç¤ºæ§½ä½
                    cardSlots.forEach(slot => slot.classList.remove('highlight'));
                    this.currentSlot.classList.add('highlight');
                    
                    // æ˜¾ç¤ºé¢æ¿å’Œé®ç½©
                    cardInfoPanel.style.display = 'block';
                    overlay.style.display = 'block';
                } else {
                    // æ‰€æœ‰æ§½ä½å·²æ»¡ï¼Œé‡ç½®å¡ç‰Œä½ç½®
                    this.resetCardPosition(card);
                }
            }
            
            // å°†å¡ç‰Œæ”¾å…¥æ§½ä½
            placeCardInSlot(card, slot) {
                // æ ‡è®°æ§½ä½å·²å¡«å……
                slot.setAttribute('data-filled', 'true');
                slot.classList.add('filled');
                
                // è®°å½•å¡ç‰Œä½ç½®å’Œå…³è”æ§½ä½
                card.position = slot.getAttribute('data-position');
                card.placed = true;
                card.slotElement = slot;
                this.selectedCards.push(card);
                
                // è®¡ç®—æ§½ä½ä¸­å¿ƒä½ç½® (ä¸–ç•Œåæ ‡)
                const slotRect = slot.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                const targetX = (slotRect.left + slotRect.width / 2) - canvasRect.left - card.width / 2;
                const targetY = (slotRect.top + slotRect.height / 2) - canvasRect.top - card.height / 2;
                
                // è®¾ç½®åŠ¨ç”»å‚æ•°
                const animationDuration = 600; // æ¯«ç§’
                const startTime = Date.now();
                const startX = card.x;
                const startY = card.y;
                const startScale = card.currentScale;
                const targetScale = 1.8; // å¡ç‰Œåœ¨æ§½ä¸­çš„å¤§å°
                const startAngle = card.angle;
                const targetAngle = 0; // å¡ç‰Œåœ¨æ§½ä¸­ä¸ºæ­£å‘
                
                // è®¾ç½®åŠ¨ç”»çŠ¶æ€
                this.isAnimating = true;
                card.animating = true;
                
                // åŠ¨ç”»å‡½æ•°
                const animate = () => {
                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / animationDuration, 1);
                    
                    // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°
                    const easeProgress = this.easeOutQuad(progress);
                    
                    // æ›´æ–°å¡ç‰Œä½ç½®
                    card.x = startX + (targetX - startX) * easeProgress;
                    card.y = startY + (targetY - startY) * easeProgress;
                    card.currentScale = startScale + (targetScale - startScale) * easeProgress;
                    card.angle = startAngle + (targetAngle - startAngle) * easeProgress;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // åŠ¨ç”»å®Œæˆ
                        card.animating = false;
                        this.isAnimating = false;
                        
                        // æ›´æ–°é€‰ä¸­å¡ç‰Œè®¡æ•°
                        cardsCounter.textContent = `å·²é€‰æ‹©: ${this.selectedCards.length}/3`;
                        
                        // å¦‚æœå·²é€‰æ‹©3å¼ å¡ç‰Œï¼Œæ˜¾ç¤ºæŸ¥çœ‹ç»“æœæŒ‰é’®
                        if (this.selectedCards.length === 3) {
                            drawInstruction.textContent = "å·²æŠ½å–æ‰€æœ‰å¡”ç½—ç‰Œ";
                            viewResultBtn.classList.remove('hidden');
                            
                            // æ›´æ–°æŸ¥çœ‹ç»“æœæŒ‰é’®çš„é“¾æ¥
                            const resultBtn = viewResultBtn.querySelector('a');
                            if (resultBtn && master && question) {
                                resultBtn.href = `result.html?master=${master}&question=${encodeURIComponent(question)}&spread=${spread || 'time-flow'}`;
                            }
                        } else {
                            drawInstruction.textContent = `å·²æŠ½å– ${this.selectedCards.length}/3 å¼ ç‰Œï¼Œè¯·ç»§ç»­é€‰æ‹©`;
                        }
                        
                        // å–æ¶ˆæ§½ä½é«˜äº®
                        this.currentSlot.classList.remove('highlight');
                    }
                };
                
                requestAnimationFrame(animate);
            }
            
            // é‡ç½®å¡ç‰Œä½ç½®
            resetCardPosition(card) {
                // å¦‚æœæ‰€æœ‰æ§½ä½å·²æ»¡ï¼Œå°†å¡ç‰ŒåŠ¨ç”»å›åŸä½
                const originalX = card.x;
                const originalY = card.y;
                const originalScale = card.currentScale;
                const originalAngle = card.angle;
                
                const animationDuration = 500; // æ¯«ç§’
                const startTime = Date.now();
                
                // è®¾ç½®åŠ¨ç”»çŠ¶æ€
                this.isAnimating = true;
                card.animating = true;
                
                // åŠ¨ç”»å‡½æ•°
                const animate = () => {
                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / animationDuration, 1);
                    
                    // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°
                    const easeProgress = this.easeOutQuad(progress);
                    
                    // æ›´æ–°å¡ç‰Œä½ç½®
                    card.x = originalX;
                    card.y = originalY;
                    card.currentScale = originalScale;
                    card.angle = originalAngle;
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // åŠ¨ç”»å®Œæˆ
                        card.animating = false;
                        this.isAnimating = false;
                    }
                };
                
                requestAnimationFrame(animate);
            }
            
            // ç¼“åŠ¨å‡½æ•°
            easeOutQuad(t) {
                return t * (2-t);
            }
            
            // ç»˜åˆ¶å‡½æ•°
            draw() {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight);
                
                // ç»˜åˆ¶ä¸€äº›è£…é¥°æ˜Ÿæ˜Ÿ
                this.drawStars();
                
                // å…ˆç»˜åˆ¶ç‰Œåˆ—ä¸­çš„ç‰Œ
                this.cards.forEach(card => {
                    if (!card.placed) {
                        card.draw(ctx);
                    }
                });
                
                // æ ¹æ®å¡ç‰Œå¯¹åº”çš„positioné¡ºåºæ’åº
                const positionOrder = {"è¿‡å»": 0, "ç°åœ¨": 1, "æœªæ¥": 2};
                const sortedPlacedCards = [...this.selectedCards].sort((a, b) => {
                    return positionOrder[a.position] - positionOrder[b.position];
                });
                
                // å†ç»˜åˆ¶å·²æ”¾ç½®çš„å¡ç‰Œï¼Œç¡®ä¿å®ƒä»¬æ˜¾ç¤ºåœ¨æ§½ä½ä¸Šæ–¹
                sortedPlacedCards.forEach(card => {
                    card.draw(ctx);
                });
                
                // ç»˜åˆ¶æŒ‡ç¤ºçº¿
                if (this.selectedCards.length > 0) {
                    // å¦‚æœæœ‰æ”¾ç½®çš„å¡ç‰Œï¼Œç»˜åˆ¶å¡ç‰Œä¸æ§½ä½ä¹‹é—´çš„è¿æ¥çº¿
                    this.drawCardConnectionLines();
                }
            }
            
            // ç»˜åˆ¶å¡ç‰Œä¸æ§½ä½ä¹‹é—´çš„è¿æ¥çº¿
            drawCardConnectionLines() {
                this.selectedCards.forEach(card => {
                    if (card.slotElement) {
                        // ç»˜åˆ¶ä»å¡ç‰Œä¸­å¿ƒåˆ°æ§½ä½ä¸­å¿ƒçš„çº¿
                        const slotRect = card.slotElement.getBoundingClientRect();
                        const canvasRect = canvas.getBoundingClientRect();
                        
                        // è®¡ç®—æ§½ä½ä¸­å¿ƒåœ¨canvasåæ ‡ç³»ä¸­çš„ä½ç½®
                        const slotCenterX = (slotRect.left + slotRect.width / 2) - canvasRect.left;
                        const slotCenterY = (slotRect.top + slotRect.height / 2) - canvasRect.top;
                        
                        // è®¡ç®—å¡ç‰Œä¸­å¿ƒ
                        const cardCenterX = card.x + card.width / 2;
                        const cardCenterY = card.y + card.height / 2;
                        
                        // ç»˜åˆ¶è¿æ¥çº¿
                        ctx.save();
                        ctx.strokeStyle = 'rgba(215, 170, 100, 0.2)';
                        ctx.lineWidth = 1;
                        ctx.setLineDash([5, 3]);
                        ctx.beginPath();
                        ctx.moveTo(cardCenterX, cardCenterY);
                        ctx.lineTo(slotCenterX, slotCenterY);
                        ctx.stroke();
                        ctx.restore();
                    }
                });
            }
            
            // ç»˜åˆ¶èƒŒæ™¯æ˜Ÿæ˜Ÿ
            drawStars() {
                const time = Date.now() / 1000;
                const numStars = 50;
                
                for (let i = 0; i < numStars; i++) {
                    const x = (Math.sin(i * 0.3 + time * 0.1) * 0.5 + 0.5) * this.canvasWidth;
                    const y = (Math.cos(i * 0.5 + time * 0.1) * 0.5 + 0.5) * this.canvasHeight * 0.7;
                    const size = (Math.sin(i + time) * 0.5 + 0.5) * 2 + 0.5;
                    const alpha = (Math.sin(i * 0.2 + time * 0.5) * 0.5 + 0.5) * 0.3 + 0.1;
                    
                    ctx.fillStyle = `rgba(215, 170, 100, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            // åŠ¨ç”»å¾ªç¯
            animate() {
                this.draw();
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // æ·»åŠ åœ†è§’çŸ©å½¢æ–¹æ³•
        CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
            if (w < 2 * r) r = w / 2;
            if (h < 2 * r) r = h / 2;
            this.beginPath();
            this.moveTo(x + r, y);
            this.arcTo(x + w, y, x + w, y + h, r);
            this.arcTo(x + w, y + h, x, y + h, r);
            this.arcTo(x, y + h, x, y, r);
            this.arcTo(x, y, x + w, y, r);
            this.closePath();
            return this;
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        let app;
        
        // ç¡®ä¿DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            app = new TarotApp();
        });
        
        // å¦‚æœå·²åŠ è½½å®Œæˆåˆ™ç«‹å³åˆå§‹åŒ–
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(() => { app = new TarotApp(); }, 1);
        }
    </script>
</body>
</html> 