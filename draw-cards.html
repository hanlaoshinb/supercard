<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½å–å¡”ç½—ç‰Œ - å¡”ç½—ç‰Œåœ¨çº¿å åœ</title>
    <meta name="description" content="æŠ½å–æ‚¨çš„å¡”ç½—ç‰Œï¼Œè·å¾—ä¸“ä¸šå¡”ç½—ç‰Œå åœè§£è¯»ï¼Œäº†è§£æ‚¨çš„çˆ±æƒ…ã€äº‹ä¸šå’Œäººç”Ÿèµ°å‘ã€‚">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7D56F4', // ä¸»è‰²è°ƒï¼Œç´«è‰²
                        secondary: '#FFC107', // è¾…åŠ©è‰²ï¼Œé‡‘è‰²
                        dark: '#1D1D1F', // æ·±è‰²èƒŒæ™¯
                        light: '#F5F5F7', // æµ…è‰²èƒŒæ™¯
                    },
                    fontFamily: {
                        sans: ['SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-gradient {
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }
            
            .tarot-card {
                transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
                transform-style: preserve-3d;
                perspective: 1000px;
            }
            
            .tarot-card.flipped {
                transform: rotateY(180deg);
            }
            
            .tarot-card-front,
            .tarot-card-back {
                backface-visibility: hidden;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }
            
            .tarot-card-front {
                transform: rotateY(180deg);
            }
            
            .tarot-card-back {
                transform: rotateY(0deg);
            }
            
            .card-1 {
                transform: translateX(-40%) rotate(-8deg);
            }
            
            .card-2 {
                transform: translateX(0);
                z-index: 10;
            }
            
            .card-3 {
                transform: translateX(40%) rotate(8deg);
            }
            
            @keyframes float {
                0% {
                    transform: translateY(0px);
                }
                50% {
                    transform: translateY(-10px);
                }
                100% {
                    transform: translateY(0px);
                }
            }
            
            .floating {
                animation: float 3s ease-in-out infinite;
            }
            
            .mystic-bg {
                background: linear-gradient(135deg, #1a1a2e, #16213e, #1a1a2e);
            }
            
            .tarot-canvas-container {
                position: relative;
                width: 100%;
                height: 500px;
                overflow: hidden;
                border-radius: 1rem;
                box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            }
            
            .slots-container {
                display: flex;
                justify-content: center;
                gap: 2rem;
                margin-top: 1.5rem;
            }
            
            .tarot-slot {
                width: 100px;
                height: 160px;
                border: 2px dashed rgba(215, 170, 100, 0.4);
                border-radius: 0.5rem;
                display: flex;
                align-items: center;
                justify-content: center;
                color: rgba(215, 170, 100, 0.6);
                font-size: 0.8rem;
                font-family: 'Times New Roman', serif;
                position: relative;
                transition: all 0.3s ease;
            }
            
            .tarot-slot:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: linear-gradient(135deg, rgba(26, 26, 46, 0.4), rgba(22, 33, 62, 0.4));
                border-radius: 0.4rem;
                z-index: -1;
            }
            
            .tarot-slot.active {
                border-color: rgba(215, 170, 100, 0.8);
                box-shadow: 0 0 15px rgba(215, 170, 100, 0.3);
            }
            
            .fade-in {
                animation: fadeIn 0.5s ease-in-out forwards;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
        }
    </style>
</head>
<body class="font-sans text-dark bg-light min-h-screen flex flex-col">
    <!-- ç§»åŠ¨è®¾å¤‡å¯¼èˆªèœå• -->
    <div id="mobile-menu" class="fixed inset-0 bg-dark/95 z-50 flex items-center justify-center transform transition-transform duration-300 translate-x-full">
        <button id="close-menu" class="absolute top-5 right-5 text-white focus:outline-none">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>
        <nav class="flex flex-col items-center space-y-6">
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                <span class="mr-1">ğŸ‘‘</span> ä¼šå‘˜è®¢é˜…
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                AIå¡”ç½—å åœ
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                æ•…äº‹åˆ†äº«
            </a>
            <a href="#" class="text-xl font-medium text-white hover:text-primary transition-colors">
                é—®é¢˜åé¦ˆ
            </a>
        </nav>
    </div>

    <!-- å¯¼èˆªæ  -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-200">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <a href="/" class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
                <span class="text-xl font-bold">Tarotap</span>
            </a>
            
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    <span class="mr-1">ğŸ‘‘</span> ä¼šå‘˜è®¢é˜…
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    AIå¡”ç½—å åœ
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    æ•…äº‹åˆ†äº«
                </a>
                <a href="#" class="flex items-center px-2 py-1 rounded-md font-medium text-gray-700 hover:text-primary transition-colors">
                    é—®é¢˜åé¦ˆ
                </a>
            </nav>
            
            <div class="flex items-center space-x-4">
                <button id="mobile-menu-btn" class="md:hidden text-dark focus:outline-none">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div class="hidden md:block h-8 w-8 rounded-full bg-gradient-to-r from-primary to-purple-300 flex items-center justify-center text-white">
                    <span class="text-sm font-medium">M</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="flex-grow">
        <!-- æŠ½ç‰ŒåŒºåŸŸ -->
        <section class="py-6 md:py-8 text-center">
            <div class="container mx-auto px-4 max-w-4xl">
                <h1 class="text-3xl md:text-4xl font-bold mb-3 flex flex-col items-center justify-center">
                    <span class="text-gradient bg-gradient-to-r from-purple-500 to-primary block">æ—¶é—´æµç‰Œé˜µ</span>
                </h1>
                
                <p class="text-gray-600 text-sm md:text-base max-w-2xl mx-auto mb-6">ä»å¡”ç½—ç‰Œä¸­æŠ½å–ä¸‰å¼ ç‰Œï¼Œæ­ç¤ºè¿‡å»ã€ç°åœ¨å’Œæœªæ¥çš„è®¯æ¯ã€‚</p>
                
                <!-- ç”¨æˆ·é—®é¢˜æ˜¾ç¤º -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-8">
                    <h3 class="text-gray-500 text-sm mb-1">æ‚¨çš„é—®é¢˜</h3>
                    <p id="user-question" class="text-gray-800 font-medium">åŠ è½½ä¸­...</p>
                </div>
                
                <!-- Canvas æŠ½ç‰ŒåŒºåŸŸ -->
                <div class="mystic-bg rounded-xl p-4 mb-6 fade-in">
                    <div class="tarot-canvas-container">
                        <canvas id="tarotCanvas"></canvas>
                    </div>
                    
                    <!-- å¡æ§½åŒºåŸŸ -->
                    <div class="slots-container">
                        <div class="tarot-slot" data-position="è¿‡å»">è¿‡å»</div>
                        <div class="tarot-slot" data-position="ç°åœ¨">ç°åœ¨</div>
                        <div class="tarot-slot" data-position="æœªæ¥">æœªæ¥</div>
                    </div>
                </div>
                
                <!-- æŒ‡å¼•æ–‡å­— -->
                <p id="draw-instruction" class="text-primary font-medium mb-6">è¯·ä»ç‰Œåˆ—ä¸­é€‰æ‹©ä¸‰å¼ å¡”ç½—ç‰Œ</p>
                
                <!-- æŸ¥çœ‹ç»“æœæŒ‰é’® (åˆå§‹éšè—) -->
                <div id="view-result-btn" class="hidden">
                    <a href="#" class="inline-block bg-gradient-to-r from-primary to-purple-800 text-white font-medium py-3 px-8 rounded-lg shadow-lg hover:shadow-xl hover:translate-y-[-2px] transition-all duration-200 relative overflow-hidden group">
                        <span class="relative z-10">æŸ¥çœ‹å åœç»“æœ</span>
                        <span class="absolute inset-0 bg-gradient-to-r from-primary/80 to-purple-700/80 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></span>
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- é¡µè„š -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">å…³äºæˆ‘ä»¬</h3>
                    <p class="text-gray-400 text-sm">Tarotapæ˜¯ä¸€ä¸ªä¸“ä¸šçš„åœ¨çº¿å¡”ç½—ç‰Œå åœå¹³å°ï¼Œè‡´åŠ›äºé€šè¿‡ç°ä»£ç§‘æŠ€ä¸å¤è€æ™ºæ…§çš„ç»“åˆï¼Œä¸ºç”¨æˆ·æä¾›å‡†ç¡®ã€ä¾¿æ·çš„å¡”ç½—ç‰Œè§£è¯»æœåŠ¡ã€‚</p>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">å¿«é€Ÿé“¾æ¥</h3>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">é¦–é¡µ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">å¡”ç½—ç‰Œå åœ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">ä¼šå‘˜æœåŠ¡</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white transition-colors">å­¦ä¹ ä¸­å¿ƒ</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">è”ç³»æˆ‘ä»¬</h3>
                    <ul class="space-y-2 text-sm">
                        <li class="flex items-start">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 mr-2 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                            <span class="text-gray-400">contact@aihinto.com</span>
                        </li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">å…³æ³¨æˆ‘ä»¬</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
                <p>&copy; 2025 Tarotap. ç‰ˆæƒæ‰€æœ‰ Michael</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript ä»£ç  -->
    <script>
        // ç§»åŠ¨è®¾å¤‡èœå•æ§åˆ¶
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        const closeMenuBtn = document.getElementById('close-menu');

        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-full');
            mobileMenu.classList.add('translate-x-0');
        });

        closeMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.remove('translate-x-0');
            mobileMenu.classList.add('translate-x-full');
        });
        
        // ä»URLè·å–æŸ¥è¯¢å‚æ•°
        const urlParams = new URLSearchParams(window.location.search);
        const master = urlParams.get('master');
        const question = urlParams.get('question');
        const spread = urlParams.get('spread');
        
        // æ˜¾ç¤ºç”¨æˆ·é—®é¢˜
        const userQuestionEl = document.getElementById('user-question');
        if (question) {
            userQuestionEl.textContent = decodeURIComponent(question);
        } else {
            userQuestionEl.textContent = "æ²¡æœ‰æä¾›é—®é¢˜";
        }
        
        // æ›´æ–°æ ‡é¢˜æ˜¾ç¤ºé€‰æ‹©çš„ç‰Œé˜µ
        const titleEl = document.querySelector('h1 span');
        if (spread) {
            const spreadName = decodeURIComponent(spread).replace(/-/g, ' ');
            const capitalizedSpread = spreadName.split(' ')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
            titleEl.textContent = capitalizedSpread + 'ç‰Œé˜µ';
        }
        
        // å¡”ç½—ç‰ŒCanvasç›¸å…³ä»£ç 
        const canvas = document.getElementById('tarotCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.querySelector('.tarot-canvas-container');
        
        // è°ƒæ•´canvaså°ºå¯¸ä»¥é€‚åº”å®¹å™¨
        function resizeCanvas() {
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
            
            // å¦‚æœå¡ç‰‡å·²ç»åˆå§‹åŒ–ï¼Œé‡æ–°ç»˜åˆ¶
            if (typeof drawTarotCards === 'function' && cards.length > 0) {
                drawTarotCards();
            }
        }
        
        // ç›‘å¬çª—å£å¤§å°å˜åŒ–
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        
        // å®šä¹‰å¡”ç½—ç‰Œæ•°æ®
        const tarotCardNames = [
            "æ„šè€…", "é­”æœ¯å¸ˆ", "å¥³ç¥­å¸", "å¥³çš‡", "çš‡å¸", "æ•™çš‡", "æ‹äºº", "æˆ˜è½¦", 
            "åŠ›é‡", "éšè€…", "å‘½è¿ä¹‹è½®", "æ­£ä¹‰", "æ‚¬åŠè€…", "æ­»ç¥", "èŠ‚åˆ¶", "æ¶é­”", 
            "å¡”", "æ˜Ÿæ˜Ÿ", "æœˆäº®", "å¤ªé˜³", "å®¡åˆ¤", "ä¸–ç•Œ"
        ];
        
        // ç”Ÿæˆéšæœºå¡ç‰Œæ•°æ®
        const generateRandomTarotCards = (count) => {
            const cards = [];
            for (let i = 0; i < count; i++) {
                const randomIndex = Math.floor(Math.random() * tarotCardNames.length);
                cards.push({
                    id: i,
                    name: tarotCardNames[randomIndex],
                    x: 0,  // åˆå§‹xä½ç½®
                    y: 0,  // åˆå§‹yä½ç½®
                    width: 80,  // å¡ç‰‡å®½åº¦
                    height: 120, // å¡ç‰‡é«˜åº¦
                    isHovered: false,
                    isSelected: false,
                    isPlaced: false,
                    slotPosition: null,
                    animationProgress: 0,
                    targetX: 0,
                    targetY: 0,
                    angle: 0
                });
            }
            return cards;
        };
        
        // åˆå§‹åŒ–å˜é‡
        let cards = generateRandomTarotCards(12);
        let hoveredCard = null;
        let selectedCard = null;
        let currentAnimatingCard = null;
        let slots = document.querySelectorAll('.tarot-slot');
        let drawnCards = 0;
        const drawInstruction = document.getElementById('draw-instruction');
        const viewResultBtn = document.getElementById('view-result-btn');
        
        // è®¡ç®—å¡ç‰‡åœ¨ç‰Œåˆ—ä¸­çš„ä½ç½®
        function calculateCardPositions() {
            const totalWidth = cards.length * (cards[0].width * 0.5) + cards[0].width * 0.5;
            const startX = (canvas.width - totalWidth) / 2;
            
            cards.forEach((card, index) => {
                if (!card.isPlaced) {
                    card.x = startX + index * (card.width * 0.5);
                    card.y = canvas.height / 2 - card.height / 2;
                    card.angle = 0;
                }
            });
        }
        
        // ç»˜åˆ¶å¡ç‰‡èƒŒé¢
        function drawCardBack(ctx, card) {
            const gradient = ctx.createLinearGradient(card.x, card.y, card.x + card.width, card.y + card.height);
            gradient.addColorStop(0, '#2c2c54');
            gradient.addColorStop(1, '#34294f');
            
            // å¡ç‰‡å¤–æ¡†
            ctx.save();
            ctx.translate(card.x + card.width / 2, card.y + card.height / 2);
            ctx.rotate(card.angle * Math.PI / 180);
            
            // å¤–å‘å…‰æ•ˆæœ(å¦‚æœæ˜¯æ‚¬æµ®çŠ¶æ€)
            if (card.isHovered && !card.isSelected && !card.isPlaced) {
                ctx.shadowColor = 'rgba(215, 170, 100, 0.8)';
                ctx.shadowBlur = 20;
            }
            
            // ç»˜åˆ¶å¡ç‰‡ä¸»ä½“
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(-card.width/2, -card.height/2, card.width, card.height, 6);
            ctx.fill();
            
            // ç»˜åˆ¶å¡ç‰‡è¾¹æ¡†
            ctx.strokeStyle = card.isHovered && !card.isSelected && !card.isPlaced ? 
                'rgba(215, 170, 100, 0.8)' : 'rgba(215, 170, 100, 0.3)';
            ctx.lineWidth = card.isHovered && !card.isSelected && !card.isPlaced ? 2 : 1;
            ctx.stroke();
            
            // ç»˜åˆ¶å¡ç‰‡èŠ±çº¹
            ctx.fillStyle = 'rgba(215, 170, 100, 0.2)';
            ctx.font = '20px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('âœ¦', 0, 0);
            
            // ç»˜åˆ¶èŠ±çº¹è¾¹æ¡†
            ctx.strokeStyle = 'rgba(215, 170, 100, 0.3)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.roundRect(-card.width/2 + 10, -card.height/2 + 10, card.width - 20, card.height - 20, 4);
            ctx.stroke();
            
            ctx.restore();
        }
        
        // ç»˜åˆ¶å¡ç‰‡æ­£é¢
        function drawCardFront(ctx, card) {
            // åˆ›å»ºæ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(card.x, card.y, card.x, card.y + card.height);
            gradient.addColorStop(0, '#2c1362');
            gradient.addColorStop(1, '#4e2a84');
            
            ctx.save();
            ctx.translate(card.x + card.width / 2, card.y + card.height / 2);
            ctx.rotate(card.angle * Math.PI / 180);
            
            // å¤–å‘å…‰æ•ˆæœ
            ctx.shadowColor = 'rgba(215, 170, 100, 0.5)';
            ctx.shadowBlur = 15;
            
            // ç»˜åˆ¶å¡ç‰‡ä¸»ä½“
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.roundRect(-card.width/2, -card.height/2, card.width, card.height, 6);
            ctx.fill();
            
            // ç»˜åˆ¶å¡ç‰‡è¾¹æ¡†
            ctx.strokeStyle = 'rgba(215, 170, 100, 0.6)';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // ç»˜åˆ¶å¡ç‰‡å†…å®¹
            ctx.fillStyle = 'rgba(215, 170, 100, 0.9)';
            ctx.font = '14px serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(card.name, 0, -card.height/4);
            
            // ç»˜åˆ¶ç¬¦å·
            ctx.font = '22px serif';
            ctx.fillText('âœ¦', 0, 0);
            
            // ç»˜åˆ¶èŠ±çº¹è¾¹æ¡†
            ctx.strokeStyle = 'rgba(215, 170, 100, 0.4)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.roundRect(-card.width/2 + 8, -card.height/2 + 8, card.width - 16, card.height - 16, 3);
            ctx.stroke();
            
            // å¦‚æœæœ‰æ—¶é—´ä½ç½®ï¼Œåœ¨åº•éƒ¨æ˜¾ç¤º
            if (card.slotPosition) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.font = '12px serif';
                ctx.fillText(card.slotPosition, 0, card.height/3);
            }
            
            ctx.restore();
        }
        
        // ä¸»ç»˜åˆ¶å‡½æ•°
        function drawTarotCards() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ç¥ç§˜èƒŒæ™¯
            drawMysticBackground();
            
            // è®¡ç®—å¡ç‰‡ä½ç½®
            calculateCardPositions();
            
            // å…ˆç»˜åˆ¶æ™®é€šå¡ç‰‡
            cards.forEach(card => {
                if (!card.isSelected && !card.isPlaced && currentAnimatingCard !== card) {
                    drawCardBack(ctx, card);
                }
            });
            
            // ç»˜åˆ¶é€‰ä¸­çš„å¡ç‰‡
            cards.forEach(card => {
                if ((card.isSelected || card.isPlaced) && currentAnimatingCard !== card) {
                    drawCardFront(ctx, card);
                }
            });
            
            // ç»˜åˆ¶æ­£åœ¨åŠ¨ç”»çš„å¡ç‰‡ï¼ˆæœ€åç»˜åˆ¶ï¼Œä½¿å…¶åœ¨æœ€ä¸Šå±‚ï¼‰
            if (currentAnimatingCard) {
                if (currentAnimatingCard.isSelected || currentAnimatingCard.isPlaced) {
                    drawCardFront(ctx, currentAnimatingCard);
                } else {
                    drawCardBack(ctx, currentAnimatingCard);
                }
            }
            
            // åŠ¨ç”»å¾ªç¯
            requestAnimationFrame(drawTarotCards);
        }
        
        // ç»˜åˆ¶ç¥ç§˜èƒŒæ™¯
        function drawMysticBackground() {
            // åˆ›å»ºæ¸å˜èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, 'rgba(26, 26, 46, 0.2)');
            gradient.addColorStop(0.5, 'rgba(22, 33, 62, 0.3)');
            gradient.addColorStop(1, 'rgba(26, 26, 46, 0.2)');
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // ç»˜åˆ¶ä¸€äº›ç¥ç§˜ç‚¹ç¼€
            for (let i = 0; i < 30; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 2 + 0.5;
                const opacity = Math.random() * 0.5 + 0.1;
                
                ctx.beginPath();
                ctx.arc(x, y, size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(215, 170, 100, ${opacity})`;
                ctx.fill();
            }
        }
        
        // æ£€æŸ¥é¼ æ ‡æ˜¯å¦æ‚¬æµ®åœ¨å¡ç‰‡ä¸Š
        function isMouseOverCard(x, y, card) {
            return x >= card.x && 
                   x <= card.x + card.width && 
                   y >= card.y && 
                   y <= card.y + card.height;
        }
        
        // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // é‡ç½®æ‰€æœ‰å¡ç‰‡çš„æ‚¬æµ®çŠ¶æ€
            cards.forEach(card => {
                if (!card.isSelected && !card.isPlaced) {
                    card.isHovered = false;
                }
            });
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å¡ç‰‡è¢«æ‚¬æµ®
            hoveredCard = null;
            for (let i = cards.length - 1; i >= 0; i--) {
                const card = cards[i];
                if (!card.isSelected && !card.isPlaced && isMouseOverCard(x, y, card)) {
                    card.isHovered = true;
                    hoveredCard = card;
                    break;
                }
            }
            
            // æ›´æ–°é¼ æ ‡æ ·å¼
            canvas.style.cursor = hoveredCard ? 'pointer' : 'default';
        });
        
        // é¼ æ ‡ç‚¹å‡»äº‹ä»¶
        canvas.addEventListener('click', (e) => {
            if (hoveredCard && !hoveredCard.isSelected && !hoveredCard.isPlaced && drawnCards < 3 && !currentAnimatingCard) {
                selectCard(hoveredCard);
            }
        });
        
        // é€‰æ‹©å¡ç‰‡
        function selectCard(card) {
            currentAnimatingCard = card;
            card.isSelected = true;
            
            // æ’­æ”¾æŠ½å–åŠ¨ç”»
            const centerX = canvas.width / 2 - card.width / 2;
            const centerY = canvas.height / 2 - card.height * 1.5;
            
            animateCard(card, centerX, centerY, 0, () => {
                // åŠ¨ç”»å®Œæˆåæš‚åœä¸€ä¼šå„¿
                setTimeout(() => {
                    // åœ¨ä¸‹ä¸€ä¸ªç©ºé—²å¡æ§½æ”¾ç½®å¡ç‰‡
                    placeCardInSlot(card);
                }, 800);
            });
        }
        
        // å°†å¡ç‰‡æ”¾å…¥å¡æ§½
        function placeCardInSlot(card) {
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºçš„å¡æ§½
            const emptySlotIndex = Array.from(slots).findIndex(slot => !slot.classList.contains('active'));
            
            if (emptySlotIndex !== -1) {
                const slot = slots[emptySlotIndex];
                const slotRect = slot.getBoundingClientRect();
                const canvasRect = canvas.getBoundingClientRect();
                
                // è®¡ç®—ç›¸å¯¹äºcanvasçš„ä½ç½®
                const slotX = slotRect.left - canvasRect.left + (slotRect.width - card.width) / 2;
                const slotY = slotRect.top - canvasRect.top - card.height / 2;
                
                // è®¾ç½®å¡ç‰‡æ§½ä½ç½®ä¿¡æ¯
                card.slotPosition = slot.dataset.position;
                
                // å¡ç‰‡æ”¾å…¥åŠ¨ç”»
                animateCard(card, slotX, slotY, 0, () => {
                    card.isPlaced = true;
                    currentAnimatingCard = null;
                    
                    // æ›´æ–°å¡æ§½æ ·å¼
                    slot.classList.add('active');
                    
                    // å¢åŠ è®¡æ•°
                    drawnCards++;
                    
                    // æ›´æ–°æŒ‡å¼•æ–‡å­—
                    if (drawnCards < 3) {
                        drawInstruction.textContent = `å·²æŠ½å– ${drawnCards}/3 å¼ ç‰Œï¼Œè¯·ç»§ç»­é€‰æ‹©`;
                    } else {
                        drawInstruction.textContent = "å·²å®Œæˆæ‰€æœ‰ç‰Œçš„æŠ½å–";
                        viewResultBtn.classList.remove('hidden');
                        
                        // æ›´æ–°æŸ¥çœ‹ç»“æœæŒ‰é’®çš„é“¾æ¥
                        const resultBtn = viewResultBtn.querySelector('a');
                        if (resultBtn && master && question) {
                            resultBtn.href = `result.html?master=${master}&question=${encodeURIComponent(question)}&spread=${spread || 'time-flow'}`;
                        }
                    }
                });
            }
        }
        
        // å¡ç‰‡åŠ¨ç”»å‡½æ•°
        function animateCard(card, targetX, targetY, targetAngle, callback) {
            const startX = card.x;
            const startY = card.y;
            const startAngle = card.angle;
            const duration = 1000; // åŠ¨ç”»æŒç»­æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
            const startTime = Date.now();
            
            function animate() {
                const currentTime = Date.now();
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°ä½¿åŠ¨ç”»æ›´æµç•…
                const easeProgress = easeOutCubic(progress);
                
                // æ›´æ–°å¡ç‰‡ä½ç½®
                card.x = startX + (targetX - startX) * easeProgress;
                card.y = startY + (targetY - startY) * easeProgress;
                card.angle = startAngle + (targetAngle - startAngle) * easeProgress;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    if (callback) callback();
                }
            }
            
            animate();
        }
        
        // ç¼“åŠ¨å‡½æ•°
        function easeOutCubic(x) {
            return 1 - Math.pow(1 - x, 3);
        }
        
        // å¼€å§‹ç»˜åˆ¶
        drawTarotCards();
    </script>
</body>
</html> 